var Xe=Object.defineProperty;var Ye=(i,a,t)=>a in i?Xe(i,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[a]=t;var ne=(i,a,t)=>Ye(i,typeof a!="symbol"?a+"":a,t);import{j as e,L as Qe,U as Se,S as de,D as L,a as Oe,b as Ze,m as H,c as Ne,d as X,e as Y,f as ea,g as ye,T as $e,C as Pe,A as U,h as G,R as aa,B as ta,i as sa,X as ia,Y as ra,k as na,l as oa,n as la,o as Le,F as se,p as be,q as Ie,r as Me,E as ca,M as Ae,P as Re,s as qe,t as me,u as ae,v as da,w as ma,x as ue,y as ua,z as ha,G as ze,H as xa,I as q,J as fa,K as ga,N as ba}from"./vendor-gDEpP9D1.js";import{b as pa,g as ja,R as u,u as va,L as We,a as x,d as Na,B as wa,e as ya,f as $}from"./react-B3S2uIsT.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();var oe={},ke;function Ca(){if(ke)return oe;ke=1;var i=pa();return oe.createRoot=i.createRoot,oe.hydrateRoot=i.hydrateRoot,oe}var Sa=Ca();const _a=ja(Sa);function J(i,a={}){let r={Dashboard:"/",Clientes:"/clientes",ClienteDetalle:"/clientes",Tareas:"/tareas",Cobros:"/cobros",Configuracion:"/configuracion"}[i]||"/";if(Object.keys(a).length>0){const s=new URLSearchParams(a);r+=`?${s.toString()}`}return r}var y;let te=(y=class{constructor(a={}){this.id=a.id||"user_1",this.nombre=a.nombre||"Usuario",this.email=a.email||"usuario@crm.com",this.empresa=a.empresa||"Mi Empresa",this.dias_alerta_global=a.dias_alerta_global||7,this.tema=a.tema||"light",this.idioma=a.idioma||"es",this.notificaciones_email=a.notificaciones_email!==void 0?a.notificaciones_email:!0,this.fecha_creacion=a.fecha_creacion||new Date().toISOString(),this.ultima_actualizacion=a.ultima_actualizacion||new Date().toISOString()}validate(){const a=[];return this.nombre.trim()||a.push("El nombre es requerido"),this.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.email)||a.push("El email no tiene un formato válido"):a.push("El email es requerido"),(this.dias_alerta_global<1||this.dias_alerta_global>365)&&a.push("Los días de alerta deben estar entre 1 y 365"),{isValid:a.length===0,errors:a}}toJSON(){return{id:this.id,nombre:this.nombre,email:this.email,empresa:this.empresa,dias_alerta_global:this.dias_alerta_global,tema:this.tema,idioma:this.idioma,notificaciones_email:this.notificaciones_email,fecha_creacion:this.fecha_creacion,ultima_actualizacion:this.ultima_actualizacion}}static getStorage(){const a=localStorage.getItem(this.storageKey);return a?JSON.parse(a):null}static setStorage(a){localStorage.setItem(this.storageKey,JSON.stringify(a))}static async me(){return new Promise(a=>{try{let t=this.getStorage();t||(t=new y().toJSON(),this.setStorage(t)),a(t)}catch{const r=new y().toJSON();a(r)}})}static async updateMyUserData(a){return new Promise((t,r)=>{try{let s=this.getStorage();s||(s=new y().toJSON());const n=new y({...s,...a,ultima_actualizacion:new Date().toISOString()}),o=n.validate();if(!o.isValid){r(new Error(o.errors.join(", ")));return}const l=n.toJSON();this.setStorage(l),t(l)}catch(s){r(s)}})}static async updateConfig(a){return new Promise((t,r)=>{try{let s=this.getStorage();s||(s=new y().toJSON());const n=["dias_alerta_global","tema","idioma","notificaciones_email"],o={};Object.keys(a).forEach(c=>{n.includes(c)&&(o[c]=a[c])});const l=new y({...s,...o,ultima_actualizacion:new Date().toISOString()}),d=l.validate();if(!d.isValid){r(new Error(d.errors.join(", ")));return}const m=l.toJSON();this.setStorage(m),t(m)}catch(s){r(s)}})}static async updateProfile(a){return new Promise((t,r)=>{try{let s=this.getStorage();s||(s=new y().toJSON());const n=["nombre","email","empresa"],o={};Object.keys(a).forEach(c=>{n.includes(c)&&(o[c]=a[c])});const l=new y({...s,...o,ultima_actualizacion:new Date().toISOString()}),d=l.validate();if(!d.isValid){r(new Error(d.errors.join(", ")));return}const m=l.toJSON();this.setStorage(m),t(m)}catch(s){r(s)}})}static async getConfig(){return new Promise(a=>{try{const t=this.getStorage();if(!t){const r=new y;a({dias_alerta_global:r.dias_alerta_global,tema:r.tema,idioma:r.idioma,notificaciones_email:r.notificaciones_email});return}a({dias_alerta_global:t.dias_alerta_global,tema:t.tema,idioma:t.idioma,notificaciones_email:t.notificaciones_email})}catch{const r=new y;a({dias_alerta_global:r.dias_alerta_global,tema:r.tema,idioma:r.idioma,notificaciones_email:r.notificaciones_email})}})}static async resetToDefaults(){return new Promise(a=>{try{const t=new y().toJSON();this.setStorage(t),a(t)}catch{const r=new y().toJSON();a(r)}})}static async exportConfig(){return new Promise(a=>{try{const t=this.getStorage();a(t||new y().toJSON())}catch{a(new y().toJSON())}})}static async importConfig(a){return new Promise((t,r)=>{try{const s=new y(a),n=s.validate();if(!n.isValid){r(new Error(n.errors.join(", ")));return}const o=s.toJSON();this.setStorage(o),t(o)}catch(s){r(s)}})}static async initialize(){const a=this.getStorage();if(!a){const t=new y({nombre:"Usuario CRM",email:"admin@crm.local",empresa:"Mi Empresa CRM",dias_alerta_global:7,tema:"light",idioma:"es",notificaciones_email:!0});return this.setStorage(t.toJSON()),t.toJSON()}return a}},ne(y,"storageKey","crm_user_config"),y);const Ve=u.createContext();function Da({children:i,...a}){const[t,r]=u.useState(!0),s=()=>r(!t),n=()=>r(!0),o=()=>r(!1);return e.jsx(Ve.Provider,{value:{isOpen:t,toggle:s,open:n,close:o},children:e.jsx("div",{className:"flex h-screen bg-gray-100",...a,children:i})})}function pe(){const i=u.useContext(Ve);if(!i)throw new Error("useSidebar must be used within a SidebarProvider");return i}function Ea({children:i,className:a="",...t}){const{isOpen:r}=pe();return e.jsx("aside",{className:`${r?"w-64":"w-16"} bg-white shadow-lg transition-all duration-300 ${a}`,...t,children:i})}function Pa({children:i,className:a="",...t}){return e.jsx("div",{className:`p-4 border-b border-gray-200 ${a}`,...t,children:i})}function za({children:i,className:a="",...t}){return e.jsx("div",{className:`flex-1 overflow-y-auto ${a}`,...t,children:i})}function ka({children:i,className:a="",...t}){return e.jsx("div",{className:`p-4 border-t border-gray-200 ${a}`,...t,children:i})}function Ta({children:i,className:a="",...t}){return e.jsx("div",{className:`py-2 ${a}`,...t,children:i})}function Fa({children:i,className:a="",...t}){const{isOpen:r}=pe();return e.jsx("div",{className:`px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider ${r?"":"hidden"} ${a}`,...t,children:i})}function Oa({children:i,className:a="",...t}){return e.jsx("div",{className:a,...t,children:i})}function $a({children:i,className:a="",...t}){return e.jsx("nav",{className:`space-y-1 ${a}`,...t,children:i})}function La({children:i,className:a="",...t}){return e.jsx("div",{className:a,...t,children:i})}function Ia({children:i,className:a="",isActive:t=!1,asChild:r=!1,...s}){const{isOpen:n}=pe(),l=`${`
    flex items-center w-full px-4 py-2 text-sm font-medium rounded-lg transition-colors duration-200
    ${t?"bg-blue-50 text-blue-700 border-r-2 border-blue-700":"text-gray-700 hover:bg-gray-50 hover:text-gray-900"}
    ${n?"justify-start":"justify-center px-2"}
  `} ${a}`;return r&&u.isValidElement(i)?u.cloneElement(i,{className:l,...s}):e.jsx("button",{className:l,...s,children:i})}function Ma({className:i="",...a}){const{toggle:t}=pe();return e.jsx("button",{onClick:t,className:`p-2 rounded-lg hover:bg-gray-100 transition-colors ${i}`,...a,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})}const Aa=[{title:"Dashboard",url:J("Dashboard"),icon:Qe},{title:"Clientes",url:J("Clientes"),icon:Se},{title:"Tareas",url:J("Tareas"),icon:de},{title:"Cobros",url:J("Cobros"),icon:L},{title:"Configuración",url:J("Configuracion"),icon:Oe}];function Ra({children:i,currentPageName:a}){var l,d;const t=va(),[r,s]=u.useState(null);u.useEffect(()=>{n()},[]);const n=async()=>{try{const m=await te.me();s(m)}catch{console.log("Usuario no autenticado")}},o=async()=>{await te.logout()};return e.jsxs(Da,{children:[e.jsx("style",{children:`
        :root {
          --primary: 222 47% 36%;
          --primary-foreground: 210 40% 98%;
          --secondary: 210 40% 96%;
          --accent: 160 60% 50%;
          --muted: 210 40% 96%;
        }
      `}),e.jsxs("div",{className:"min-h-screen flex w-full bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:[e.jsxs(Ea,{className:"border-r border-slate-200/60 bg-white/80 backdrop-blur-xl",children:[e.jsx(Pa,{className:"border-b border-slate-200/60 p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/30",children:e.jsx(Se,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-slate-900 text-lg",children:"CRM Gestoría Romero"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Gestión Inteligente"})]})]})}),e.jsx(za,{className:"p-3",children:e.jsxs(Ta,{children:[e.jsx(Fa,{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider px-3 py-2",children:"Navegación"}),e.jsx(Oa,{children:e.jsx($a,{children:Aa.map(m=>e.jsx(La,{children:e.jsx(Ia,{asChild:!0,className:`hover:bg-blue-50 hover:text-blue-700 transition-all duration-200 rounded-xl mb-1 ${t.pathname===m.url?"bg-gradient-to-r from-blue-500 to-indigo-500 text-white shadow-lg shadow-blue-500/30":""}`,children:e.jsxs(We,{to:m.url,className:"flex items-center gap-3 px-4 py-3",children:[e.jsx(m.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:m.title})]})})},m.title))})})]})}),e.jsx(ka,{className:"border-t border-slate-200/60 p-4",children:r&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 px-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-full flex items-center justify-center shadow-md",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:((d=(l=r.full_name)==null?void 0:l[0])==null?void 0:d.toUpperCase())||"U"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-slate-900 text-sm truncate",children:r.full_name}),e.jsx("p",{className:"text-xs text-slate-500 truncate",children:r.email})]})]}),e.jsxs("button",{onClick:o,className:"w-full flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors duration-200",children:[e.jsx(Ze,{className:"w-4 h-4"}),"Cerrar Sesión"]})]})})]}),e.jsxs("main",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white/80 backdrop-blur-xl border-b border-slate-200/60 px-6 py-4 md:hidden",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Ma,{className:"hover:bg-slate-100 p-2 rounded-lg transition-colors duration-200"}),e.jsx("h1",{className:"text-xl font-bold text-slate-900",children:"CRM Gestoría Romero"})]})}),e.jsx("div",{className:"flex-1 overflow-auto",children:i})]})]})]})}const Z=class Z{constructor(a={}){this.id=a.id||this.generateId(),this.nombre_completo=a.nombre_completo||"",this.empresa=a.empresa||"",this.email=a.email||"",this.telefono=a.telefono||"",this.direccion=a.direccion||"",this.ciudad=a.ciudad||"",this.pais=a.pais||"",this.notas=a.notas||"",this.dias_alerta=a.dias_alerta||7,this.fecha_creacion=a.fecha_creacion||new Date().toISOString(),this.ultima_actualizacion=a.ultima_actualizacion||new Date().toISOString()}generateId(){return"cli_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}validate(){const a=[];return this.nombre_completo.trim()||a.push("El nombre completo es requerido"),this.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.email)||a.push("El email no tiene un formato válido"):a.push("El email es requerido"),{isValid:a.length===0,errors:a}}toJSON(){return{id:this.id,nombre_completo:this.nombre_completo,empresa:this.empresa,email:this.email,telefono:this.telefono,direccion:this.direccion,ciudad:this.ciudad,pais:this.pais,notas:this.notas,dias_alerta:this.dias_alerta,fecha_creacion:this.fecha_creacion,ultima_actualizacion:this.ultima_actualizacion}}static getStorage(){const a=localStorage.getItem(this.storageKey);return a?JSON.parse(a):[]}static setStorage(a){localStorage.setItem(this.storageKey,JSON.stringify(a))}static async create(a){return new Promise((t,r)=>{try{const s=new Z(a),n=s.validate();if(!n.isValid){r(new Error(n.errors.join(", ")));return}const o=this.getStorage();if(o.some(d=>d.email===s.email)){r(new Error("Ya existe un cliente con este email"));return}o.push(s.toJSON()),this.setStorage(o),t(s.toJSON())}catch(s){r(s)}})}static async list(a="nombre_completo"){return new Promise(t=>{try{let r=this.getStorage();if(a.startsWith("-")){const s=a.substring(1);r.sort((n,o)=>n[s]<o[s]?1:n[s]>o[s]?-1:0)}else r.sort((s,n)=>s[a]<n[a]?-1:s[a]>n[a]?1:0);t(r)}catch{t([])}})}static async findById(a){return new Promise((t,r)=>{try{const n=this.getStorage().find(o=>o.id===a);n?t(n):r(new Error("Cliente no encontrado"))}catch(s){r(s)}})}static async filter(a,t="nombre_completo"){return new Promise(r=>{try{let s=this.getStorage();if(Object.keys(a).forEach(n=>{const o=a[n];s=s.filter(l=>typeof o=="string"?l[n]&&l[n].toLowerCase().includes(o.toLowerCase()):l[n]===o)}),t.startsWith("-")){const n=t.substring(1);s.sort((o,l)=>o[n]<l[n]?1:o[n]>l[n]?-1:0)}else s.sort((n,o)=>n[t]<o[t]?-1:n[t]>o[t]?1:0);r(s)}catch{r([])}})}static async update(a,t){return new Promise((r,s)=>{try{const n=this.getStorage(),o=n.findIndex(m=>m.id===a);if(o===-1){s(new Error("Cliente no encontrado"));return}const l=new Z({...n[o],...t,ultima_actualizacion:new Date().toISOString()}),d=l.validate();if(!d.isValid){s(new Error(d.errors.join(", ")));return}if(t.email&&n.some(c=>c.email===t.email&&c.id!==a)){s(new Error("Ya existe un cliente con este email"));return}n[o]=l.toJSON(),this.setStorage(n),r(n[o])}catch(n){s(n)}})}static async delete(a){return new Promise((t,r)=>{try{const s=this.getStorage(),n=s.findIndex(l=>l.id===a);if(n===-1){r(new Error("Cliente no encontrado"));return}const o=s[n];s.splice(n,1),this.setStorage(s),t(o)}catch(s){r(s)}})}static async search(a,t=["nombre_completo","empresa","email"]){return new Promise(r=>{try{const s=this.getStorage(),n=a.toLowerCase(),o=s.filter(l=>t.some(d=>l[d]&&l[d].toLowerCase().includes(n)));r(o)}catch{r([])}})}static async initializeWithSampleData(){if(this.getStorage().length===0){const t=[{nombre_completo:"Juan Pérez",empresa:"Tecnologías Avanzadas S.A.",email:"juan.perez@tecavanzadas.com",telefono:"+1234567890",direccion:"Av. Libertad 123",ciudad:"Buenos Aires",pais:"Argentina",notas:"Cliente desde 2020, muy puntual con los pagos",dias_alerta:5},{nombre_completo:"María García",empresa:"Consultoría García",email:"maria@consultoriagarcia.com",telefono:"+1234567891",direccion:"Calle Principal 456",ciudad:"Madrid",pais:"España",notas:"Requiere atención personalizada",dias_alerta:7},{nombre_completo:"Carlos Rodríguez",empresa:"Emprendimientos CR",email:"carlos.rodriguez@empcr.com",telefono:"+1234567892",direccion:"Zona Industrial 789",ciudad:"Monterrey",pais:"México",notas:"Cliente nuevo, potencial alto volumen",dias_alerta:10}];for(const r of t)await this.create(r)}}};ne(Z,"storageKey","crm_clientes");let O=Z;const qa=Object.freeze(Object.defineProperty({__proto__:null,Cliente:O},Symbol.toStringTag,{value:"Module"})),Wa="modulepreload",Va=function(i){return"/"+i},Te={},Ja=function(a,t,r){let s=Promise.resolve();if(t&&t.length>0){let o=function(m){return Promise.all(m.map(c=>Promise.resolve(c).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),d=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));s=o(t.map(m=>{if(m=Va(m),m in Te)return;Te[m]=!0;const c=m.endsWith(".css"),f=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${f}`))return;const h=document.createElement("link");if(h.rel=c?"stylesheet":Wa,c||(h.as="script"),h.crossOrigin="",h.href=m,d&&h.setAttribute("nonce",d),document.head.appendChild(h),c)return new Promise((z,_)=>{h.addEventListener("load",z),h.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${m}`)))})}))}function n(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return s.then(o=>{for(const l of o||[])l.status==="rejected"&&n(l.reason);return a().catch(n)})},ee=class ee{constructor(a={}){this.id=a.id||this.generateId(),this.cliente_id=a.cliente_id||"",this.titulo=a.titulo||"",this.descripcion=a.descripcion||"",this.estado=a.estado||"iniciada",this.monto=a.monto||0,this.fecha_inicio=a.fecha_inicio||new Date().toISOString().split("T")[0],this.fecha_finalizacion=a.fecha_finalizacion||null,this.fecha_cobro=a.fecha_cobro||null,this.fecha_creacion=a.fecha_creacion||new Date().toISOString(),this.ultima_actualizacion=a.ultima_actualizacion||new Date().toISOString()}generateId(){return"tarea_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}validate(){const a=[];return this.cliente_id.trim()||a.push("El ID del cliente es requerido"),this.titulo.trim()||a.push("El título es requerido"),["iniciada","en_proceso","finalizada","cobrada"].includes(this.estado)||a.push("El estado debe ser: iniciada, en_proceso, finalizada o cobrada"),this.monto<0&&a.push("El monto no puede ser negativo"),{isValid:a.length===0,errors:a}}toJSON(){return{id:this.id,cliente_id:this.cliente_id,titulo:this.titulo,descripcion:this.descripcion,estado:this.estado,monto:this.monto,fecha_inicio:this.fecha_inicio,fecha_finalizacion:this.fecha_finalizacion,fecha_cobro:this.fecha_cobro,fecha_creacion:this.fecha_creacion,ultima_actualizacion:this.ultima_actualizacion}}static getStorage(){const a=localStorage.getItem(this.storageKey);return a?JSON.parse(a):[]}static setStorage(a){localStorage.setItem(this.storageKey,JSON.stringify(a))}static async create(a){return new Promise((t,r)=>{try{const s=new ee(a),n=s.validate();if(!n.isValid){r(new Error(n.errors.join(", ")));return}const o=this.getStorage();o.push(s.toJSON()),this.setStorage(o),t(s.toJSON())}catch(s){r(s)}})}static async list(a="-ultima_actualizacion"){return new Promise(t=>{try{let r=this.getStorage();if(a.startsWith("-")){const s=a.substring(1);r.sort((n,o)=>n[s]<o[s]?1:n[s]>o[s]?-1:0)}else r.sort((s,n)=>s[a]<n[a]?-1:s[a]>n[a]?1:0);t(r)}catch{t([])}})}static async findById(a){return new Promise((t,r)=>{try{const n=this.getStorage().find(o=>o.id===a);n?t(n):r(new Error("Tarea no encontrada"))}catch(s){r(s)}})}static async filter(a,t="-ultima_actualizacion"){return new Promise(r=>{try{let s=this.getStorage();if(Object.keys(a).forEach(n=>{const o=a[n];s=s.filter(l=>typeof o=="string"?l[n]&&l[n].toString().toLowerCase().includes(o.toLowerCase()):l[n]===o)}),t.startsWith("-")){const n=t.substring(1);s.sort((o,l)=>o[n]<l[n]?1:o[n]>l[n]?-1:0)}else s.sort((n,o)=>n[t]<o[t]?-1:n[t]>o[t]?1:0);r(s)}catch{r([])}})}static async update(a,t){return new Promise((r,s)=>{try{const n=this.getStorage(),o=n.findIndex(f=>f.id===a);if(o===-1){s(new Error("Tarea no encontrada"));return}const l=n[o],d={...t};d.estado==="finalizada"&&!d.fecha_finalizacion&&(d.fecha_finalizacion=new Date().toISOString().split("T")[0]),d.estado==="cobrada"&&!d.fecha_cobro&&(d.fecha_cobro=new Date().toISOString().split("T")[0],l.fecha_finalizacion||(d.fecha_finalizacion=d.fecha_cobro));const m=new ee({...l,...d,ultima_actualizacion:new Date().toISOString()}),c=m.validate();if(!c.isValid){s(new Error(c.errors.join(", ")));return}n[o]=m.toJSON(),this.setStorage(n),r(n[o])}catch(n){s(n)}})}static async delete(a){return new Promise((t,r)=>{try{const s=this.getStorage(),n=s.findIndex(l=>l.id===a);if(n===-1){r(new Error("Tarea no encontrada"));return}const o=s[n];s.splice(n,1),this.setStorage(s),t(o)}catch(s){r(s)}})}static async getByClienteId(a){return this.filter({cliente_id:a})}static async search(a,t=["titulo","descripcion"]){return new Promise(r=>{try{const s=this.getStorage(),n=a.toLowerCase(),o=s.filter(l=>t.some(d=>l[d]&&l[d].toLowerCase().includes(n)));r(o)}catch{r([])}})}static async getStats(){return new Promise(a=>{try{const t=this.getStorage(),r={total:t.length,iniciadas:t.filter(s=>s.estado==="iniciada").length,en_proceso:t.filter(s=>s.estado==="en_proceso").length,finalizadas:t.filter(s=>s.estado==="finalizada").length,cobradas:t.filter(s=>s.estado==="cobrada").length,total_cobrado:t.filter(s=>s.estado==="cobrada").reduce((s,n)=>s+(n.monto||0),0),total_pendiente:t.filter(s=>s.estado==="finalizada").reduce((s,n)=>s+(n.monto||0),0)};a(r)}catch{a({total:0,iniciadas:0,en_proceso:0,finalizadas:0,cobradas:0,total_cobrado:0,total_pendiente:0})}})}static async initializeWithSampleData(){var t,r;if(this.getStorage().length===0){const{Cliente:s}=await Ja(async()=>{const{Cliente:o}=await Promise.resolve().then(()=>qa);return{Cliente:o}},void 0),n=await s.list();if(n.length>0){const o=[{cliente_id:n[0].id,titulo:"Configuración sistema contable",descripcion:"Instalación y configuración del nuevo sistema contable para la empresa",estado:"en_proceso",monto:1500,fecha_inicio:"2024-10-01"},{cliente_id:n[0].id,titulo:"Capacitación equipo",descripcion:"Capacitación del equipo en el uso del nuevo sistema",estado:"finalizada",monto:800,fecha_inicio:"2024-09-15",fecha_finalizacion:"2024-09-30"},{cliente_id:((t=n[1])==null?void 0:t.id)||n[0].id,titulo:"Consultoría fiscal",descripcion:"Asesoramiento fiscal para el cierre del ejercicio",estado:"cobrada",monto:2200,fecha_inicio:"2024-09-01",fecha_finalizacion:"2024-09-20",fecha_cobro:"2024-09-25"},{cliente_id:((r=n[2])==null?void 0:r.id)||n[0].id,titulo:"Auditoría interna",descripcion:"Auditoría de procesos internos y recomendaciones de mejora",estado:"iniciada",monto:3500,fecha_inicio:"2024-10-05"}];for(const l of o)await this.create(l)}}}};ne(ee,"storageKey","crm_tareas");let k=ee;const N=u.forwardRef(({className:i="",variant:a="default",size:t="default",asChild:r=!1,...s},n)=>{const o="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",l={default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},d={default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"},m=`${o} ${l[a]} ${d[t]} ${i}`;return r&&u.isValidElement(s.children)?u.cloneElement(s.children,{ref:n,className:m,...s}):e.jsx("button",{ref:n,className:m,...s})});N.displayName="Button";function I({className:i="",...a}){return e.jsx("div",{className:`animate-pulse rounded-md bg-muted ${i}`,...a})}const E=u.forwardRef(({className:i="",...a},t)=>e.jsx("div",{ref:t,className:`rounded-lg border bg-card text-card-foreground shadow-sm ${i}`,...a}));E.displayName="Card";const M=u.forwardRef(({className:i="",...a},t)=>e.jsx("div",{ref:t,className:`flex flex-col space-y-1.5 p-6 ${i}`,...a}));M.displayName="CardHeader";const A=u.forwardRef(({className:i="",...a},t)=>e.jsx("h3",{ref:t,className:`text-2xl font-semibold leading-none tracking-tight ${i}`,...a}));A.displayName="CardTitle";const Ua=u.forwardRef(({className:i="",...a},t)=>e.jsx("p",{ref:t,className:`text-sm text-muted-foreground ${i}`,...a}));Ua.displayName="CardDescription";const P=u.forwardRef(({className:i="",...a},t)=>e.jsx("div",{ref:t,className:`p-6 pt-0 ${i}`,...a}));P.displayName="CardContent";const Ha=u.forwardRef(({className:i="",...a},t)=>e.jsx("div",{ref:t,className:`flex items-center p-6 pt-0 ${i}`,...a}));Ha.displayName="CardFooter";function le({title:i,value:a,icon:t,gradient:r,trend:s,subtitle:n}){return e.jsx(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(E,{className:"border-0 shadow-lg shadow-slate-200/50 hover:shadow-xl hover:shadow-slate-300/50 transition-all duration-300 overflow-hidden group",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 ${r} opacity-10 rounded-full blur-3xl group-hover:opacity-20 transition-opacity duration-300`}),e.jsxs(P,{className:"p-6 relative",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-slate-500 mb-1",children:i}),e.jsx("h3",{className:"text-3xl font-bold text-slate-900",children:a}),n&&e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:n})]}),e.jsx("div",{className:`p-3 rounded-xl ${r} bg-opacity-10 group-hover:scale-110 transition-transform duration-300`,children:e.jsx(t,{className:`w-6 h-6 ${r.replace("bg-","text-").replace("to-","").split(" ")[0]}`})})]}),s&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs font-semibold px-2 py-1 rounded-full ${s.type==="up"?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"}`,children:s.value}),e.jsx("span",{className:"text-xs text-slate-500",children:s.label})]})]})]})})}const K=u.forwardRef(({className:i="",variant:a="default",...t},r)=>{const o=`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 ${{default:"bg-primary text-primary-foreground hover:bg-primary/80",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground border border-input bg-background hover:bg-accent hover:text-accent-foreground",success:"bg-green-100 text-green-800 hover:bg-green-200",warning:"bg-yellow-100 text-yellow-800 hover:bg-yellow-200",danger:"bg-red-100 text-red-800 hover:bg-red-200",info:"bg-blue-100 text-blue-800 hover:bg-blue-200"}[a]} ${i}`;return e.jsx("div",{ref:r,className:o,...t})});K.displayName="Badge";const Ga={lessThanXSeconds:{one:"menos de un segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"medio minuto",lessThanXMinutes:{one:"menos de un minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"alrededor de 1 hora",other:"alrededor de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 día",other:"{{count}} días"},aboutXWeeks:{one:"alrededor de 1 semana",other:"alrededor de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"alrededor de 1 mes",other:"alrededor de {{count}} meses"},xMonths:{one:"1 mes",other:"{{count}} meses"},aboutXYears:{one:"alrededor de 1 año",other:"alrededor de {{count}} años"},xYears:{one:"1 año",other:"{{count}} años"},overXYears:{one:"más de 1 año",other:"más de {{count}} años"},almostXYears:{one:"casi 1 año",other:"casi {{count}} años"}},Ka=(i,a,t)=>{let r;const s=Ga[i];return typeof s=="string"?r=s:a===1?r=s.one:r=s.other.replace("{{count}}",a.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"en "+r:"hace "+r:r},Ba={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/y"},Xa={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},Ya={full:"{{date}} 'a las' {{time}}",long:"{{date}} 'a las' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Qa={date:Ne({formats:Ba,defaultWidth:"full"}),time:Ne({formats:Xa,defaultWidth:"full"}),dateTime:Ne({formats:Ya,defaultWidth:"full"})},Za={lastWeek:"'el' eeee 'pasado a la' p",yesterday:"'ayer a la' p",today:"'hoy a la' p",tomorrow:"'mañana a la' p",nextWeek:"eeee 'a la' p",other:"P"},et={lastWeek:"'el' eeee 'pasado a las' p",yesterday:"'ayer a las' p",today:"'hoy a las' p",tomorrow:"'mañana a las' p",nextWeek:"eeee 'a las' p",other:"P"},at=(i,a,t,r)=>a.getHours()!==1?et[i]:Za[i],tt={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","después de cristo"]},st={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1º trimestre","2º trimestre","3º trimestre","4º trimestre"]},it={narrow:["e","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],wide:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]},rt={narrow:["d","l","m","m","j","v","s"],short:["do","lu","ma","mi","ju","vi","sá"],abbreviated:["dom","lun","mar","mié","jue","vie","sáb"],wide:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"]},nt={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"}},ot={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"}},lt=(i,a)=>Number(i)+"º",ct={ordinalNumber:lt,era:X({values:tt,defaultWidth:"wide"}),quarter:X({values:st,defaultWidth:"wide",argumentCallback:i=>Number(i)-1}),month:X({values:it,defaultWidth:"wide"}),day:X({values:rt,defaultWidth:"wide"}),dayPeriod:X({values:nt,defaultWidth:"wide",formattingValues:ot,defaultFormattingWidth:"wide"})},dt=/^(\d+)(º)?/i,mt=/\d+/i,ut={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|a\.?\s?e\.?\s?c\.?|d\.?\s?c\.?|e\.?\s?c\.?)/i,wide:/^(antes de cristo|antes de la era com[uú]n|despu[eé]s de cristo|era com[uú]n)/i},ht={any:[/^ac/i,/^dc/i],wide:[/^(antes de cristo|antes de la era com[uú]n)/i,/^(despu[eé]s de cristo|era com[uú]n)/i]},xt={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234](º)? trimestre/i},ft={any:[/1/i,/2/i,/3/i,/4/i]},gt={narrow:/^[efmajsond]/i,abbreviated:/^(ene|feb|mar|abr|may|jun|jul|ago|sep|oct|nov|dic)/i,wide:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i},bt={narrow:[/^e/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^en/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i]},pt={narrow:/^[dlmjvs]/i,short:/^(do|lu|ma|mi|ju|vi|s[áa])/i,abbreviated:/^(dom|lun|mar|mi[ée]|jue|vie|s[áa]b)/i,wide:/^(domingo|lunes|martes|mi[ée]rcoles|jueves|viernes|s[áa]bado)/i},jt={narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^do/i,/^lu/i,/^ma/i,/^mi/i,/^ju/i,/^vi/i,/^sa/i]},vt={narrow:/^(a|p|mn|md|(de la|a las) (mañana|tarde|noche))/i,any:/^([ap]\.?\s?m\.?|medianoche|mediodia|(de la|a las) (mañana|tarde|noche))/i},Nt={any:{am:/^a/i,pm:/^p/i,midnight:/^mn/i,noon:/^md/i,morning:/mañana/i,afternoon:/tarde/i,evening:/tarde/i,night:/noche/i}},wt={ordinalNumber:ea({matchPattern:dt,parsePattern:mt,valueCallback:function(i){return parseInt(i,10)}}),era:Y({matchPatterns:ut,defaultMatchWidth:"wide",parsePatterns:ht,defaultParseWidth:"any"}),quarter:Y({matchPatterns:xt,defaultMatchWidth:"wide",parsePatterns:ft,defaultParseWidth:"any",valueCallback:i=>i+1}),month:Y({matchPatterns:gt,defaultMatchWidth:"wide",parsePatterns:bt,defaultParseWidth:"any"}),day:Y({matchPatterns:pt,defaultMatchWidth:"wide",parsePatterns:jt,defaultParseWidth:"any"}),dayPeriod:Y({matchPatterns:vt,defaultMatchWidth:"any",parsePatterns:Nt,defaultParseWidth:"any"})},Q={code:"es",formatDistance:Ka,formatLong:Qa,formatRelative:at,localize:ct,match:wt,options:{weekStartsOn:1,firstWeekContainsDate:1}};function yt({tareas:i,clientes:a}){const[t,r]=x.useState(7);x.useEffect(()=>{s()},[]);const s=async()=>{try{const l=await te.me();r(l.dias_alerta_global||7)}catch(l){console.error("Error cargando configuración:",l)}},n=l=>a.find(d=>d.id===l),o=i.filter(l=>{if(l.estado==="cobrada")return!1;const d=l.ultima_actualizacion||l.updated_date;return ye(new Date,new Date(d))>=t});return e.jsxs(E,{className:"border-0 shadow-lg shadow-slate-200/50",children:[e.jsx(M,{className:"border-b border-slate-100 pb-4",children:e.jsxs(A,{className:"flex items-center gap-2 text-lg font-bold text-slate-900",children:[e.jsx($e,{className:"w-5 h-5 text-amber-500"}),"Alertas de Inactividad",e.jsxs(K,{variant:"outline",className:"ml-auto",children:[t," días configurados"]})]})}),e.jsx(P,{className:"p-4",children:o.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Pe,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"No hay tareas con alertas"}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["Las tareas inactivas por más de ",t," días aparecerán aquí"]}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"(Las tareas cobradas no generan alertas)"})]}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:e.jsx(U,{children:o.map((l,d)=>{const m=n(l.cliente_id),c=l.ultima_actualizacion||l.updated_date,f=ye(new Date,new Date(c));return e.jsxs(H.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:d*.05},className:"p-4 bg-amber-50 border border-amber-200 rounded-xl hover:shadow-md transition-shadow duration-200",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:l.titulo}),e.jsx("p",{className:"text-sm text-slate-600",children:m==null?void 0:m.nombre_completo})]}),e.jsxs(K,{className:"bg-amber-500 text-white",children:[f," días"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[e.jsx(Pe,{className:"w-3 h-3"}),"Última actualización: ",G(new Date(c),"d 'de' MMMM",{locale:Q})]})]},l.id)})})})})]})}const Fe={iniciada:"#f59e0b",en_proceso:"#3b82f6",finalizada:"#10b981",cobrada:"#8b5cf6"},Ct={iniciada:"Iniciadas",en_proceso:"En Proceso",finalizada:"Finalizadas",cobrada:"Cobradas"};function St({tareas:i}){const a=Object.keys(Fe).map(t=>({name:Ct[t],value:i.filter(r=>r.estado===t).length,color:Fe[t]}));return e.jsxs(E,{className:"border-0 shadow-lg shadow-slate-200/50",children:[e.jsx(M,{className:"border-b border-slate-100 pb-4",children:e.jsx(A,{className:"text-lg font-bold text-slate-900",children:"Tareas por Estado"})}),e.jsx(P,{className:"p-6",children:e.jsx(aa,{width:"100%",height:280,children:e.jsxs(ta,{data:a,children:[e.jsx(sa,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(ia,{dataKey:"name",tick:{fontSize:12,fill:"#64748b"}}),e.jsx(ra,{tick:{fontSize:12,fill:"#64748b"}}),e.jsx(na,{contentStyle:{backgroundColor:"white",border:"none",borderRadius:"12px",boxShadow:"0 10px 40px rgba(0,0,0,0.1)"}}),e.jsx(oa,{dataKey:"value",radius:[8,8,0,0],children:a.map((t,r)=>e.jsx(la,{fill:t.color},`cell-${r}`))})]})})})]})}function _t({tareas:i,clientes:a}){const t=a.map(r=>{const s=i.filter(l=>l.cliente_id===r.id),n=s.filter(l=>l.estado==="cobrada").reduce((l,d)=>l+(d.monto||0),0),o=s.filter(l=>l.estado==="finalizada").reduce((l,d)=>l+(d.monto||0),0);return{...r,totalCobrado:n,totalPendiente:o,totalGeneral:n+o}}).sort((r,s)=>s.totalGeneral-r.totalGeneral).slice(0,5);return e.jsxs(E,{className:"border-0 shadow-lg shadow-slate-200/50",children:[e.jsx(M,{className:"border-b border-slate-100 pb-4",children:e.jsxs(A,{className:"flex items-center gap-2 text-lg font-bold text-slate-900",children:[e.jsx(Le,{className:"w-5 h-5 text-blue-500"}),"Top Clientes"]})}),e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[t.map((r,s)=>e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-slate-50 rounded-xl hover:bg-slate-100 transition-colors duration-200",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-indigo-500 flex items-center justify-center text-white font-bold shadow-md",children:s+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:r.nombre_completo}),e.jsx("p",{className:"text-xs text-slate-500",children:r.empresa||"Sin empresa"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-1 text-emerald-600 font-bold",children:[e.jsx(L,{className:"w-4 h-4"}),r.totalGeneral.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})]}),r.totalPendiente>0&&e.jsxs("p",{className:"text-xs text-amber-600",children:["$",r.totalPendiente.toLocaleString("es-ES",{minimumFractionDigits:2})," pendiente"]})]})]},r.id)),t.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-slate-500 text-sm",children:"No hay datos de clientes"})})]})})]})}function we(){const[i,a]=x.useState([]),[t,r]=x.useState([]),[s,n]=x.useState(!0);x.useEffect(()=>{o()},[]);const o=async()=>{n(!0);const[f,h]=await Promise.all([O.list(),k.list()]);a(f),r(h),n(!1)},l=t.filter(f=>f.estado==="cobrada").reduce((f,h)=>f+(h.monto||0),0),d=t.filter(f=>f.estado==="finalizada").reduce((f,h)=>f+(h.monto||0),0),m=t.filter(f=>f.estado!=="cobrada").length,c=()=>{window.print()};return s?e.jsx("div",{className:"p-4 md:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx(I,{className:"h-12 w-64"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(f=>e.jsx(I,{className:"h-40"},f))})]})}):e.jsxs("div",{className:"p-4 md:p-8",children:[e.jsx("style",{children:`
        @media print {
          body * {
            visibility: hidden;
          }
          .print-area, .print-area * {
            visibility: visible;
          }
          .print-area {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
          }
          .no-print {
            display: none !important;
          }
          @page {
            margin: 2cm;
          }
        }
      `}),e.jsxs("div",{className:"max-w-7xl mx-auto print-area",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-slate-900 mb-2",children:"Dashboard"}),e.jsx("p",{className:"text-slate-500",children:"Vista general de tu negocio"})]}),e.jsxs(N,{onClick:c,className:"bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white shadow-lg shadow-emerald-500/30 no-print",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Exportar a PDF"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(le,{title:"Total Clientes",value:i.length,icon:Se,gradient:"bg-gradient-to-br from-blue-500 to-indigo-600",subtitle:"Clientes activos"}),e.jsx(le,{title:"Tareas Activas",value:m,icon:de,gradient:"bg-gradient-to-br from-amber-500 to-orange-600",subtitle:"Sin cobrar"}),e.jsx(le,{title:"Total Cobrado",value:`$${l.toLocaleString("es-ES",{minimumFractionDigits:2})}`,icon:L,gradient:"bg-gradient-to-br from-emerald-500 to-teal-600",subtitle:"Pagos recibidos"}),e.jsx(le,{title:"Por Cobrar",value:`$${d.toLocaleString("es-ES",{minimumFractionDigits:2})}`,icon:$e,gradient:"bg-gradient-to-br from-red-500 to-pink-600",subtitle:"Trabajos finalizados"})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(St,{tareas:t})}),e.jsx("div",{children:e.jsx(_t,{tareas:t,clientes:i})})]}),e.jsx(yt,{tareas:t,clientes:i})]})]})}const C=u.forwardRef(({className:i="",type:a="text",...t},r)=>{const n=`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${i}`;return e.jsx("input",{type:a,ref:r,className:n,...t})});C.displayName="Input";const w=u.forwardRef(({className:i="",...a},t)=>{const s=`text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 ${i}`;return e.jsx("label",{ref:t,className:s,...a})});w.displayName="Label";const _e=u.forwardRef(({className:i="",...a},t)=>{const s=`flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${i}`;return e.jsx("textarea",{ref:t,className:s,...a})});_e.displayName="Textarea";function Dt({cliente:i,onSubmit:a,onCancel:t}){const[r,s]=x.useState(i||{nombre_completo:"",empresa:"",email:"",telefono:"",direccion:"",ciudad:"",pais:"",notas:"",dias_alerta:7}),n=l=>{l.preventDefault(),a(r)},o=(l,d)=>{s(m=>({...m,[l]:d}))};return e.jsx(H.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:t,children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-slate-200 p-6 flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:i?"Editar Cliente":"Nuevo Cliente"}),e.jsx(N,{variant:"ghost",size:"icon",onClick:t,children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:n,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"nombre_completo",children:"Nombre Completo *"}),e.jsx(C,{id:"nombre_completo",value:r.nombre_completo,onChange:l=>o("nombre_completo",l.target.value),placeholder:"Juan Pérez",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"empresa",children:"Empresa"}),e.jsx(C,{id:"empresa",value:r.empresa,onChange:l=>o("empresa",l.target.value),placeholder:"Empresa S.A."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"email",children:"Email *"}),e.jsx(C,{id:"email",type:"email",value:r.email,onChange:l=>o("email",l.target.value),placeholder:"cliente@email.com",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"telefono",children:"Teléfono"}),e.jsx(C,{id:"telefono",value:r.telefono,onChange:l=>o("telefono",l.target.value),placeholder:"+54 11 1234-5678"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"ciudad",children:"Ciudad"}),e.jsx(C,{id:"ciudad",value:r.ciudad,onChange:l=>o("ciudad",l.target.value),placeholder:"Buenos Aires"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"pais",children:"País"}),e.jsx(C,{id:"pais",value:r.pais,onChange:l=>o("pais",l.target.value),placeholder:"Argentina"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"direccion",children:"Dirección"}),e.jsx(C,{id:"direccion",value:r.direccion,onChange:l=>o("direccion",l.target.value),placeholder:"Calle Falsa 123"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"dias_alerta",children:"Días para Alerta de Inactividad"}),e.jsx(C,{id:"dias_alerta",type:"number",min:"1",value:r.dias_alerta,onChange:l=>o("dias_alerta",parseInt(l.target.value))}),e.jsx("p",{className:"text-xs text-slate-500",children:"Se mostrará una alerta si una tarea no se actualiza en estos días"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"notas",children:"Notas"}),e.jsx(_e,{id:"notas",value:r.notas,onChange:l=>o("notas",l.target.value),placeholder:"Información adicional sobre el cliente...",rows:4})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-200",children:[e.jsx(N,{type:"button",variant:"outline",onClick:t,children:"Cancelar"}),e.jsx(N,{type:"submit",className:"bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white shadow-lg shadow-blue-500/30",children:i?"Guardar Cambios":"Crear Cliente"})]})]})]})})}function Et({cliente:i,tareas:a,onEdit:t}){const r=a.filter(o=>o.cliente_id===i.id),s=r.filter(o=>o.estado==="cobrada").reduce((o,l)=>o+(l.monto||0),0),n=r.filter(o=>o.estado==="finalizada").reduce((o,l)=>o+(l.monto||0),0);return e.jsx(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{y:-4},transition:{duration:.2},children:e.jsxs(E,{className:"border-0 shadow-lg shadow-slate-200/50 hover:shadow-xl hover:shadow-slate-300/50 transition-all duration-300 overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-blue-500 to-indigo-600 opacity-5 rounded-full blur-3xl group-hover:opacity-10 transition-opacity duration-300"}),e.jsxs(P,{className:"p-6 relative",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-1",children:i.nombre_completo}),i.empresa&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(Ie,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:i.empresa})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{size:"icon",variant:"ghost",onClick:()=>t(i),className:"hover:bg-blue-50 hover:text-blue-600",children:e.jsx(Me,{className:"w-4 h-4"})}),e.jsx(We,{to:`${J("ClienteDetalle")}?id=${i.id}`,children:e.jsx(N,{size:"icon",variant:"ghost",className:"hover:bg-indigo-50 hover:text-indigo-600",children:e.jsx(ca,{className:"w-4 h-4"})})})]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{children:i.email})]}),i.telefono&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsx(Re,{className:"w-4 h-4"}),e.jsx("span",{children:i.telefono})]}),i.ciudad&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsx(qe,{className:"w-4 h-4"}),e.jsxs("span",{children:[i.ciudad,i.pais?`, ${i.pais}`:""]})]})]}),e.jsxs("div",{className:"border-t border-slate-100 pt-4 mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("span",{className:"text-sm text-slate-500",children:"Tareas"}),e.jsx(K,{variant:"secondary",children:r.length})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-emerald-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1 text-emerald-600 text-xs mb-1",children:[e.jsx(L,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:"Cobrado"})]}),e.jsxs("p",{className:"text-lg font-bold text-emerald-700",children:["$",s.toLocaleString("es-ES",{minimumFractionDigits:0})]})]}),e.jsxs("div",{className:"p-3 bg-amber-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1 text-amber-600 text-xs mb-1",children:[e.jsx(L,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:"Pendiente"})]}),e.jsxs("p",{className:"text-lg font-bold text-amber-700",children:["$",n.toLocaleString("es-ES",{minimumFractionDigits:0})]})]})]})]})]})]})})}function Pt(){const[i,a]=x.useState([]),[t,r]=x.useState([]),[s,n]=x.useState(!0),[o,l]=x.useState(!1),[d,m]=x.useState(null),[c,f]=x.useState("");x.useEffect(()=>{h()},[]);const h=async()=>{n(!0);const[p,v]=await Promise.all([O.list("-created_date"),k.list()]);a(p),r(v),n(!1)},z=async p=>{d?await O.update(d.id,p):await O.create(p),l(!1),m(null),h()},_=p=>{m(p),l(!0)},D=i.filter(p=>{var v,b,S;return((v=p.nombre_completo)==null?void 0:v.toLowerCase().includes(c.toLowerCase()))||((b=p.empresa)==null?void 0:b.toLowerCase().includes(c.toLowerCase()))||((S=p.email)==null?void 0:S.toLowerCase().includes(c.toLowerCase()))}),j=()=>{window.print()};return e.jsxs("div",{className:"p-4 md:p-8",children:[e.jsx("style",{children:`
        @media print {
          body * {
            visibility: hidden;
          }
          .print-area, .print-area * {
            visibility: visible;
          }
          .print-area {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
          }
          .no-print {
            display: none !important;
          }
          @page {
            margin: 2cm;
          }
        }
      `}),e.jsxs("div",{className:"max-w-7xl mx-auto print-area",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-slate-900 mb-2",children:"Clientes"}),e.jsx("p",{className:"text-slate-500",children:"Gestiona tu cartera de clientes"})]}),e.jsxs("div",{className:"flex gap-3 no-print",children:[e.jsxs(N,{variant:"outline",onClick:j,disabled:i.length===0,children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Exportar a PDF"]}),e.jsxs(N,{onClick:()=>{m(null),l(!0)},className:"bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white shadow-lg shadow-blue-500/30",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Nuevo Cliente"]})]})]}),e.jsx("div",{className:"mb-6 no-print",children:e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx(C,{placeholder:"Buscar clientes por nombre, empresa o email...",value:c,onChange:p=>f(p.target.value),className:"pl-10 h-12 border-slate-200 focus:border-blue-400 focus:ring-blue-400"})]})}),s?e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3,4,5,6].map(p=>e.jsx(I,{className:"h-80"},p))}):D.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ae,{className:"w-8 h-8 text-slate-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:c?"No se encontraron clientes":"No hay clientes"}),e.jsx("p",{className:"text-slate-500 mb-6",children:c?"Intenta con otros términos de búsqueda":"Comienza agregando tu primer cliente"}),!c&&e.jsxs(N,{onClick:()=>l(!0),className:"bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white no-print",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Agregar Cliente"]})]}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.jsx(U,{children:D.map(p=>e.jsx(Et,{cliente:p,tareas:t,onEdit:_},p.id))})}),e.jsx(U,{children:o&&e.jsx(Dt,{cliente:d,onSubmit:z,onCancel:()=>{l(!1),m(null)}})})]})]})}const ie=u.createContext();function he({children:i,value:a,onValueChange:t,defaultValue:r,...s}){const[n,o]=u.useState(a||r||""),[l,d]=u.useState(!1);u.useEffect(()=>{a!==void 0&&o(a)},[a]);const m=c=>{o(c),d(!1),t&&t(c)};return e.jsx(ie.Provider,{value:{selectedValue:n,onValueChange:m,isOpen:l,setIsOpen:d},children:e.jsx("div",{className:"relative",...s,children:i})})}function xe({children:i,className:a="",...t}){const{isOpen:r,setIsOpen:s}=u.useContext(ie);return e.jsxs("button",{type:"button",onClick:()=>s(!r),className:`flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${a}`,...t,children:[i,e.jsx(da,{className:"h-4 w-4 opacity-50"})]})}function fe({placeholder:i="Select...",className:a=""}){const{selectedValue:t}=u.useContext(ie);return e.jsx("span",{className:a,children:t||i})}function ge({children:i,className:a="",...t}){const{isOpen:r,setIsOpen:s}=u.useContext(ie);return u.useEffect(()=>{const n=o=>{r&&!o.target.closest("[data-select-content]")&&s(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[r,s]),r?e.jsx("div",{"data-select-content":!0,className:`absolute top-full z-50 mt-1 max-h-60 w-full overflow-auto rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 ${a}`,...t,children:i}):null}function F({children:i,value:a,className:t="",...r}){const{selectedValue:s,onValueChange:n}=u.useContext(ie),o=s===a;return e.jsxs("div",{onClick:()=>n(a),className:`relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 ${t}`,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:o&&e.jsx(ma,{className:"h-4 w-4"})}),i]})}function Je({tarea:i,onSubmit:a,onCancel:t}){const[r,s]=x.useState([]),[n,o]=x.useState(i||{cliente_id:"",titulo:"",descripcion:"",estado:"iniciada",monto:0,fecha_inicio:"",fecha_finalizacion:"",fecha_cobro:"",ultima_actualizacion:new Date().toISOString()});x.useEffect(()=>{l()},[]);const l=async()=>{const c=await O.list();s(c)},d=c=>{c.preventDefault(),a({...n,ultima_actualizacion:new Date().toISOString()})},m=(c,f)=>{o(h=>({...h,[c]:f}))};return e.jsx(H.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:t,children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-slate-200 p-6 flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:i?"Editar Tarea":"Nueva Tarea"}),e.jsx(N,{variant:"ghost",size:"icon",onClick:t,children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:d,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"cliente_id",children:"Cliente *"}),e.jsxs(he,{value:n.cliente_id,onValueChange:c=>m("cliente_id",c),required:!0,children:[e.jsx(xe,{children:e.jsx(fe,{placeholder:"Selecciona un cliente"})}),e.jsx(ge,{children:r.map(c=>e.jsxs(F,{value:c.id,children:[c.nombre_completo," ",c.empresa?`- ${c.empresa}`:""]},c.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"titulo",children:"Título *"}),e.jsx(C,{id:"titulo",value:n.titulo,onChange:c=>m("titulo",c.target.value),placeholder:"Diseño de sitio web",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(_e,{id:"descripcion",value:n.descripcion,onChange:c=>m("descripcion",c.target.value),placeholder:"Detalles del trabajo a realizar...",rows:4})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"estado",children:"Estado"}),e.jsxs(he,{value:n.estado,onValueChange:c=>m("estado",c),children:[e.jsx(xe,{children:e.jsx(fe,{})}),e.jsxs(ge,{children:[e.jsx(F,{value:"iniciada",children:"Iniciada"}),e.jsx(F,{value:"en_proceso",children:"En Proceso"}),e.jsx(F,{value:"finalizada",children:"Finalizada"}),e.jsx(F,{value:"cobrada",children:"Cobrada"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"monto",children:"Monto ($)"}),e.jsx(C,{id:"monto",type:"number",min:"0",step:"0.01",value:n.monto,onChange:c=>m("monto",parseFloat(c.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"fecha_inicio",children:"Fecha de Inicio"}),e.jsx(C,{id:"fecha_inicio",type:"date",value:n.fecha_inicio,onChange:c=>m("fecha_inicio",c.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"fecha_finalizacion",children:"Fecha de Finalización"}),e.jsx(C,{id:"fecha_finalizacion",type:"date",value:n.fecha_finalizacion,onChange:c=>m("fecha_finalizacion",c.target.value)})]})]}),n.estado==="cobrada"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"fecha_cobro",children:"Fecha de Cobro *"}),e.jsx(C,{id:"fecha_cobro",type:"date",value:n.fecha_cobro,onChange:c=>m("fecha_cobro",c.target.value),required:!0}),e.jsx("p",{className:"text-xs text-slate-500",children:"Esta fecha se usará para filtrar y ordenar en la sección de Cobros"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-200",children:[e.jsx(N,{type:"button",variant:"outline",onClick:t,children:"Cancelar"}),e.jsx(N,{type:"submit",className:"bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white shadow-lg shadow-blue-500/30",children:i?"Guardar Cambios":"Crear Tarea"})]})]})]})})}const je=u.createContext();function zt({children:i,open:a,onOpenChange:t}){const[r,s]=u.useState(a||!1);u.useEffect(()=>{a!==void 0&&s(a)},[a]);const n=o=>{s(o),t&&t(o)};return u.useEffect(()=>{const o=l=>{r&&!l.target.closest("[data-dropdown-menu]")&&n(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[r]),e.jsx(je.Provider,{value:{isOpen:r,onOpenChange:n},children:e.jsx("div",{className:"relative","data-dropdown-menu":!0,children:i})})}function kt({children:i,asChild:a=!1,...t}){const{isOpen:r,onOpenChange:s}=u.useContext(je),n=()=>{s(!r)};return a&&u.isValidElement(i)?u.cloneElement(i,{onClick:n,"aria-expanded":r,"aria-haspopup":!0,...t}):e.jsx("button",{onClick:n,"aria-expanded":r,"aria-haspopup":"true",...t,children:i})}function Tt({children:i,className:a="",align:t="center",side:r="bottom",sideOffset:s=4,...n}){const{isOpen:o}=u.useContext(je);if(!o)return null;const l={start:"left-0",center:"left-1/2 transform -translate-x-1/2",end:"right-0"},d={top:"bottom-full mb-2",bottom:"top-full mt-2",left:"right-full mr-2",right:"left-full ml-2"};return e.jsx("div",{className:`
        absolute z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95
        ${l[t]} ${d[r]} ${a}
      `,style:{marginTop:r==="bottom"?s:void 0},...n,children:i})}function ce({children:i,className:a="",inset:t=!1,onClick:r,...s}){const{onOpenChange:n}=u.useContext(je),o=l=>{r&&r(l),n(!1)};return e.jsx("div",{className:`
        relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors
        focus:bg-accent focus:text-accent-foreground hover:bg-accent hover:text-accent-foreground
        data-[disabled]:pointer-events-none data-[disabled]:opacity-50
        ${t?"pl-8":""} ${a}
      `,onClick:o,...s,children:i})}const re=u.createContext();function Ft({children:i,open:a,onOpenChange:t}){return e.jsxs(re.Provider,{value:{open:a,onOpenChange:t},children:[i,a&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>t(!1)}),i]})]})}function Ot({children:i,asChild:a=!1,...t}){const{onOpenChange:r}=u.useContext(re),s=()=>{r(!0)};return a&&u.isValidElement(i)?u.cloneElement(i,{onClick:s,...t}):e.jsx("button",{onClick:s,...t,children:i})}function $t({children:i,className:a="",...t}){const{open:r,onOpenChange:s}=u.useContext(re);return r?e.jsxs("div",{className:`relative z-50 w-full max-w-lg bg-white rounded-lg shadow-lg p-6 mx-4 ${a}`,...t,children:[e.jsxs("button",{onClick:()=>s(!1),className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),i]}):null}function Lt({children:i,className:a="",...t}){return e.jsx("div",{className:`flex flex-col space-y-2 text-center sm:text-left ${a}`,...t,children:i})}function It({children:i,className:a="",...t}){return e.jsx("div",{className:`flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 ${a}`,...t,children:i})}function Mt({children:i,className:a="",...t}){return e.jsx("h2",{className:`text-lg font-semibold ${a}`,...t,children:i})}function At({children:i,className:a="",...t}){return e.jsx("p",{className:`text-sm text-muted-foreground ${a}`,...t,children:i})}function Rt({children:i,className:a="",onClick:t,...r}){const{onOpenChange:s}=u.useContext(re),n=o=>{t&&t(o),s(!1)};return e.jsx("button",{className:`inline-flex h-10 items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground ring-offset-background transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 ${a}`,onClick:n,...r,children:i})}function qt({children:i,className:a="",onClick:t,...r}){const{onOpenChange:s}=u.useContext(re),n=o=>{t&&t(o),s(!1)};return e.jsx("button",{className:`inline-flex h-10 items-center justify-center rounded-md border border-input bg-background px-4 py-2 text-sm font-medium ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 ${a}`,onClick:n,...r,children:i})}const Ue=u.createContext();function Wt({children:i,open:a,onOpenChange:t,defaultOpen:r=!1}){const[s,n]=u.useState(a!==void 0?a:r);u.useEffect(()=>{a!==void 0&&n(a)},[a]);const o=l=>{n(l),t&&t(l)};return u.useEffect(()=>(s?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[s]),u.useEffect(()=>{const l=d=>{d.key==="Escape"&&s&&o(!1)};return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)},[s]),e.jsx(Ue.Provider,{value:{isOpen:s,onOpenChange:o},children:i})}function Vt({children:i,className:a="",...t}){const{isOpen:r,onOpenChange:s}=u.useContext(Ue);return r?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>s(!1)}),e.jsxs("div",{className:`
          relative z-50 grid w-full max-w-lg gap-4 border bg-background p-6 shadow-lg duration-200 
          data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 
          data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 
          data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] 
          data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] 
          sm:rounded-lg md:w-full ${a}
        `,onClick:n=>n.stopPropagation(),...t,children:[i,e.jsxs("button",{onClick:()=>s(!1),className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}):null}function Jt({children:i,className:a="",...t}){return e.jsx("div",{className:`flex flex-col space-y-1.5 text-center sm:text-left ${a}`,...t,children:i})}function Ut({children:i,className:a="",...t}){return e.jsx("div",{className:`flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 ${a}`,...t,children:i})}function Ht({children:i,className:a="",...t}){return e.jsx("h2",{className:`text-lg font-semibold leading-none tracking-tight ${a}`,...t,children:i})}function Gt({children:i,className:a="",...t}){return e.jsx("p",{className:`text-sm text-muted-foreground ${a}`,...t,children:i})}function Kt({open:i,onOpenChange:a,onConfirm:t,tarea:r}){var l;const[s,n]=x.useState((r==null?void 0:r.fecha_cobro)||new Date().toISOString().split("T")[0]),o=()=>{t(s),a(!1)};return e.jsx(Wt,{open:i,onOpenChange:a,children:e.jsxs(Vt,{className:"sm:max-w-md",children:[e.jsxs(Jt,{children:[e.jsx(Ht,{children:"Marcar como Cobrada"}),e.jsxs(Gt,{children:['Ingresa la fecha en que se realizó el cobro de "',r==null?void 0:r.titulo,'"']})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"fecha_cobro",children:"Fecha de Cobro"}),e.jsx(C,{id:"fecha_cobro",type:"date",value:s,onChange:d=>n(d.target.value),className:"h-11"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Monto a cobrar:"})," $",(l=r==null?void 0:r.monto)==null?void 0:l.toLocaleString("es-ES",{minimumFractionDigits:2})]})})]}),e.jsxs(Ut,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>a(!1),children:"Cancelar"}),e.jsx(N,{type:"button",onClick:o,className:"bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white",children:"Confirmar Cobro"})]})]})})}const Bt={me:async()=>new Promise(i=>setTimeout(()=>{i({dias_alerta_global:7})},100))},Xt={iniciada:"bg-amber-100 text-amber-800 border-amber-200",en_proceso:"bg-blue-100 text-blue-800 border-blue-200",finalizada:"bg-emerald-100 text-emerald-800 border-emerald-200",cobrada:"bg-purple-100 text-purple-800 border-purple-200"},Yt={iniciada:"Iniciada",en_proceso:"En Proceso",finalizada:"Finalizada",cobrada:"Cobrada"};function He({tarea:i,cliente:a,onEdit:t,onEstadoChange:r,onDelete:s}){const[n,o]=x.useState(!1),[l,d]=x.useState(7);x.useEffect(()=>{m()},[]);const m=async()=>{try{const D=await Bt.me();d(D.dias_alerta_global||7)}catch(D){console.error("Error cargando configuración:",D),d(7)}},c=i.ultima_actualizacion||i.updated_date,f=ye(new Date,new Date(c)),h=i.estado!=="cobrada"&&f>=l,z=D=>{D==="cobrada"?o(!0):r(i,D)},_=D=>{r(i,"cobrada",D)};return e.jsxs(e.Fragment,{children:[e.jsx(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{y:-2},transition:{duration:.2},children:e.jsxs(E,{className:`border-0 shadow-lg shadow-slate-200/50 hover:shadow-xl transition-all duration-300 overflow-hidden ${h?"ring-2 ring-amber-400":""}`,children:[h&&e.jsxs("div",{className:"bg-amber-50 border-b border-amber-200 px-4 py-2 flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-amber-600"}),e.jsxs("span",{className:"text-xs text-amber-700 font-medium",children:["Sin actividad hace ",f," días"]})]}),e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-1",children:i.titulo}),e.jsx("p",{className:"text-sm text-slate-600",children:a==null?void 0:a.nombre_completo})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(zt,{children:[e.jsx(kt,{asChild:!0,children:e.jsx(K,{className:`${Xt[i.estado]} border cursor-pointer hover:opacity-80`,children:Yt[i.estado]})}),e.jsxs(Tt,{children:[e.jsx(ce,{onClick:()=>z("iniciada"),children:"Iniciada"}),e.jsx(ce,{onClick:()=>z("en_proceso"),children:"En Proceso"}),e.jsx(ce,{onClick:()=>z("finalizada"),children:"Finalizada"}),e.jsx(ce,{onClick:()=>z("cobrada"),children:"Cobrada"})]})]}),e.jsx(N,{size:"icon",variant:"ghost",onClick:()=>t(i),className:"hover:bg-blue-50 hover:text-blue-600",children:e.jsx(Me,{className:"w-4 h-4"})}),e.jsxs(Ft,{children:[e.jsx(Ot,{asChild:!0,children:e.jsx(N,{size:"icon",variant:"ghost",className:"hover:bg-red-50 hover:text-red-600",children:e.jsx(ua,{className:"w-4 h-4"})})}),e.jsxs($t,{children:[e.jsxs(Lt,{children:[e.jsx(Mt,{children:"¿Eliminar tarea?"}),e.jsxs(At,{children:['Esta acción no se puede deshacer. Se eliminará permanentemente la tarea "',i.titulo,'".']})]}),e.jsxs(It,{children:[e.jsx(qt,{children:"Cancelar"}),e.jsx(Rt,{onClick:()=>s(i.id),className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})]})]})]}),i.descripcion&&e.jsx("p",{className:"text-sm text-slate-600 mb-4 line-clamp-2",children:i.descripcion}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-slate-100",children:[e.jsxs("div",{children:[i.fecha_inicio&&e.jsxs("p",{className:"text-xs text-slate-500",children:["Inicio: ",G(new Date(i.fecha_inicio),"d MMM yyyy",{locale:Q})]}),i.estado==="cobrada"&&i.fecha_cobro&&e.jsxs("p",{className:"text-xs text-emerald-600 font-medium",children:["Cobrado: ",G(new Date(i.fecha_cobro),"d MMM yyyy",{locale:Q})]}),c&&i.estado!=="cobrada"&&e.jsxs("p",{className:"text-xs text-slate-400",children:["Actualizado: ",G(new Date(c),"d MMM",{locale:Q})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-2xl font-bold text-slate-900",children:["$",i.monto.toLocaleString("es-ES",{minimumFractionDigits:0})]})})]})]})]})}),e.jsx(Kt,{open:n,onOpenChange:o,onConfirm:_,tarea:i})]})}function Qt(){const[i,a]=x.useState([]),[t,r]=x.useState([]),[s,n]=x.useState(!0),[o,l]=x.useState(!1),[d,m]=x.useState(null),[c,f]=x.useState(""),[h,z]=x.useState("all");x.useEffect(()=>{_()},[]);const _=async()=>{n(!0);const[g,T]=await Promise.all([k.list("-updated_date"),O.list()]);a(g),r(T),n(!1)},D=async g=>{d?await k.update(d.id,g):await k.create(g),l(!1),m(null),_()},j=async(g,T,ve=null)=>{const B={...g,estado:T,ultima_actualizacion:new Date().toISOString()};T==="finalizada"&&!g.fecha_finalizacion&&(B.fecha_finalizacion=new Date().toISOString().split("T")[0]),T==="cobrada"&&(B.fecha_cobro=ve||new Date().toISOString().split("T")[0]),await k.update(g.id,B),_()},p=g=>{m(g),l(!0)},v=async g=>{await k.delete(g),_()},b=g=>t.find(T=>T.id===g),S=i.filter(g=>{var De,Ee;const T=b(g.cliente_id),ve=((De=g.titulo)==null?void 0:De.toLowerCase().includes(c.toLowerCase()))||((Ee=T==null?void 0:T.nombre_completo)==null?void 0:Ee.toLowerCase().includes(c.toLowerCase())),B=h==="all"||g.estado===h;return ve&&B}),R=()=>{window.print()};return e.jsxs("div",{className:"p-4 md:p-8",children:[e.jsx("style",{children:`
        @media print {
          body * {
            visibility: hidden;
          }
          .print-area, .print-area * {
            visibility: visible;
          }
          .print-area {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
          }
          .no-print {
            display: none !important;
          }
          @page {
            margin: 2cm;
          }
        }
      `}),e.jsxs("div",{className:"max-w-7xl mx-auto print-area",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-slate-900 mb-2",children:"Tareas"}),e.jsx("p",{className:"text-slate-500",children:"Gestiona el trabajo de tus clientes"})]}),e.jsxs("div",{className:"flex gap-3 no-print",children:[e.jsxs(N,{variant:"outline",onClick:R,disabled:i.length===0,children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Exportar a PDF"]}),e.jsxs(N,{onClick:()=>{m(null),l(!0)},className:"bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white shadow-lg shadow-blue-500/30",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Nueva Tarea"]})]})]}),e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row gap-4 no-print",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx(C,{placeholder:"Buscar tareas por título o cliente...",value:c,onChange:g=>f(g.target.value),className:"pl-10 h-12 border-slate-200 focus:border-blue-400 focus:ring-blue-400"})]}),e.jsxs(he,{value:h,onValueChange:z,children:[e.jsxs(xe,{className:"w-full md:w-48 h-12",children:[e.jsx(ha,{className:"w-4 h-4 mr-2"}),e.jsx(fe,{})]}),e.jsxs(ge,{children:[e.jsx(F,{value:"all",children:"Todos los Estados"}),e.jsx(F,{value:"iniciada",children:"Iniciadas"}),e.jsx(F,{value:"en_proceso",children:"En Proceso"}),e.jsx(F,{value:"finalizada",children:"Finalizadas"}),e.jsx(F,{value:"cobrada",children:"Cobradas"})]})]})]}),s?e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3,4,5,6].map(g=>e.jsx(I,{className:"h-64"},g))}):S.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ae,{className:"w-8 h-8 text-slate-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:c||h!=="all"?"No se encontraron tareas":"No hay tareas"}),e.jsx("p",{className:"text-slate-500 mb-6",children:c||h!=="all"?"Intenta ajustar los filtros":"Comienza agregando tu primera tarea"}),!c&&h==="all"&&e.jsxs(N,{onClick:()=>l(!0),className:"bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white no-print",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Agregar Tarea"]})]}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.jsx(U,{children:S.map(g=>e.jsx(He,{tarea:g,cliente:b(g.cliente_id),onEdit:p,onEstadoChange:j,onDelete:v},g.id))})}),e.jsx(U,{children:o&&e.jsx(Je,{tarea:d,onSubmit:D,onCancel:()=>{l(!1),m(null)}})})]})]})}const Ge=u.forwardRef(({className:i="",...a},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:`w-full caption-bottom text-sm ${i}`,...a})}));Ge.displayName="Table";const Ke=u.forwardRef(({className:i="",...a},t)=>e.jsx("thead",{ref:t,className:`[&_tr]:border-b ${i}`,...a}));Ke.displayName="TableHeader";const Be=u.forwardRef(({className:i="",...a},t)=>e.jsx("tbody",{ref:t,className:`[&_tr:last-child]:border-0 ${i}`,...a}));Be.displayName="TableBody";const Zt=u.forwardRef(({className:i="",...a},t)=>e.jsx("tfoot",{ref:t,className:`border-t bg-muted/50 font-medium [&>tr]:last:border-b-0 ${i}`,...a}));Zt.displayName="TableFooter";const Ce=u.forwardRef(({className:i="",...a},t)=>e.jsx("tr",{ref:t,className:`border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted ${i}`,...a}));Ce.displayName="TableRow";const W=u.forwardRef(({className:i="",...a},t)=>e.jsx("th",{ref:t,className:`h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 ${i}`,...a}));W.displayName="TableHead";const V=u.forwardRef(({className:i="",...a},t)=>e.jsx("td",{ref:t,className:`p-4 align-middle [&:has([role=checkbox])]:pr-0 ${i}`,...a}));V.displayName="TableCell";const es=u.forwardRef(({className:i="",...a},t)=>e.jsx("caption",{ref:t,className:`mt-4 text-sm text-muted-foreground ${i}`,...a}));es.displayName="TableCaption";function as({fechaDesde:i,fechaHasta:a,clienteSeleccionado:t,clientes:r,onFechaDesdeChange:s,onFechaHastaChange:n,onClienteChange:o}){return e.jsx(E,{className:"border-0 shadow-lg shadow-slate-200/50 mb-6",children:e.jsxs(P,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-4",children:"Filtros de Búsqueda"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{htmlFor:"fecha_desde",className:"flex items-center gap-2 text-slate-700",children:[e.jsx(ze,{className:"w-4 h-4"}),"Fecha Desde"]}),e.jsx(C,{id:"fecha_desde",type:"date",value:i,onChange:l=>s(l.target.value),className:"h-11 border-slate-200 focus:border-blue-400 focus:ring-blue-400"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{htmlFor:"fecha_hasta",className:"flex items-center gap-2 text-slate-700",children:[e.jsx(ze,{className:"w-4 h-4"}),"Fecha Hasta"]}),e.jsx(C,{id:"fecha_hasta",type:"date",value:a,onChange:l=>n(l.target.value),className:"h-11 border-slate-200 focus:border-blue-400 focus:ring-blue-400"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{htmlFor:"cliente",className:"flex items-center gap-2 text-slate-700",children:[e.jsx(xa,{className:"w-4 h-4"}),"Cliente"]}),e.jsxs(he,{value:t,onValueChange:o,children:[e.jsx(xe,{className:"h-11 border-slate-200 focus:border-blue-400 focus:ring-blue-400",children:e.jsx(fe,{placeholder:"Todos los clientes"})}),e.jsxs(ge,{children:[e.jsx(F,{value:"all",children:"Todos los clientes"}),r.map(l=>e.jsxs(F,{value:l.id,children:[l.nombre_completo," ",l.empresa?`- ${l.empresa}`:""]},l.id))]})]})]})]})]})})}function ts({cobros:i}){const a=i.reduce((n,o)=>n+(o.monto||0),0),t=i.length,r=t>0?a/t:0,s=[{title:"Total Cobrado",value:`$${a.toLocaleString("es-ES",{minimumFractionDigits:2})}`,icon:L,gradient:"from-emerald-500 to-teal-600",bgColor:"bg-emerald-100"},{title:"Cantidad de Cobros",value:t,icon:se,gradient:"from-blue-500 to-indigo-600",bgColor:"bg-blue-100"},{title:"Promedio por Cobro",value:`$${r.toLocaleString("es-ES",{minimumFractionDigits:2})}`,icon:Le,gradient:"from-purple-500 to-pink-600",bgColor:"bg-purple-100"}];return e.jsx("div",{className:"grid md:grid-cols-3 gap-6 mb-8",children:s.map((n,o)=>e.jsx(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:o*.1},children:e.jsxs(E,{className:"border-0 shadow-lg shadow-slate-200/50 overflow-hidden group hover:shadow-xl hover:shadow-slate-300/50 transition-all duration-300",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 bg-gradient-to-br ${n.gradient} opacity-10 rounded-full blur-3xl group-hover:opacity-20 transition-opacity duration-300`}),e.jsx(P,{className:"p-6 relative",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-slate-500 mb-2",children:n.title}),e.jsx("h3",{className:"text-3xl font-bold text-slate-900",children:n.value})]}),e.jsx("div",{className:`p-3 rounded-xl ${n.bgColor} group-hover:scale-110 transition-transform duration-300`,children:e.jsx(n.icon,{className:`w-6 h-6 bg-gradient-to-br ${n.gradient} bg-clip-text text-transparent`,style:{WebkitTextFillColor:"transparent"}})})]})})]})},n.title))})}function ss(){const[i,a]=x.useState([]),[t,r]=x.useState([]),[s,n]=x.useState(!0),[o,l]=x.useState(""),[d,m]=x.useState(""),[c,f]=x.useState("all");x.useEffect(()=>{h()},[]);const h=async()=>{n(!0);const[j,p]=await Promise.all([k.filter({estado:"cobrada"},"-fecha_cobro"),O.list()]);a(j),r(p),n(!1)},z=j=>t.find(p=>p.id===j),_=i.filter(j=>{const p=c==="all"||j.cliente_id===c;let v=!0;if(j.fecha_cobro&&(o||d)){const b=q(j.fecha_cobro);o&&d?v=fa(b,{start:q(o),end:q(d)}):o?v=b>=q(o):d&&(v=b<=q(d))}return p&&v}),D=()=>{window.print()};return e.jsxs("div",{className:"p-4 md:p-8",children:[e.jsx("style",{children:`
        @media print {
          body * {
            visibility: hidden;
          }
          .print-area, .print-area * {
            visibility: visible;
          }
          .print-area {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
          }
          .no-print {
            display: none !important;
          }
          @page {
            margin: 2cm;
          }
        }
      `}),e.jsxs("div",{className:"max-w-7xl mx-auto print-area",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-slate-900 mb-2",children:"Cobros"}),e.jsx("p",{className:"text-slate-500",children:"Historial completo de pagos recibidos"})]}),e.jsxs(N,{onClick:D,disabled:_.length===0,className:"bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white shadow-lg shadow-emerald-500/30 no-print",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Exportar a PDF"]})]}),e.jsx("div",{className:"no-print",children:e.jsx(as,{fechaDesde:o,fechaHasta:d,clienteSeleccionado:c,clientes:t,onFechaDesdeChange:l,onFechaHastaChange:m,onClienteChange:f})}),s?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:[1,2,3].map(j=>e.jsx(I,{className:"h-32"},j))}),e.jsx(I,{className:"h-96"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ts,{cobros:_}),e.jsxs(E,{className:"border-0 shadow-lg shadow-slate-200/50",children:[e.jsx(M,{className:"border-b border-slate-100",children:e.jsxs(A,{className:"text-xl font-bold text-slate-900",children:["Listado de Cobros (",_.length,")"]})}),e.jsx(P,{className:"p-0",children:_.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ae,{className:"w-8 h-8 text-slate-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:"No se encontraron cobros"}),e.jsx("p",{className:"text-slate-500 mb-6",children:o||d||c!=="all"?"Intenta ajustar los filtros de búsqueda":"Aún no hay tareas cobradas en el sistema"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ge,{children:[e.jsx(Ke,{children:e.jsxs(Ce,{className:"bg-slate-50",children:[e.jsx(W,{className:"font-semibold text-slate-900",children:"Fecha de Cobro"}),e.jsx(W,{className:"font-semibold text-slate-900",children:"Cliente"}),e.jsx(W,{className:"font-semibold text-slate-900",children:"Empresa"}),e.jsx(W,{className:"font-semibold text-slate-900",children:"Tarea"}),e.jsx(W,{className:"font-semibold text-slate-900",children:"Descripción"}),e.jsx(W,{className:"font-semibold text-slate-900 text-right",children:"Monto"})]})}),e.jsx(Be,{children:_.map((j,p)=>{const v=z(j.cliente_id);return e.jsxs(Ce,{className:`hover:bg-slate-50 transition-colors ${p%2===0?"bg-white":"bg-slate-50/50"}`,children:[e.jsx(V,{className:"font-medium",children:j.fecha_cobro?e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-900",children:G(q(j.fecha_cobro),"dd/MM/yyyy")}),e.jsx("p",{className:"text-xs text-slate-500",children:G(q(j.fecha_cobro),"EEEE",{locale:Q})})]}):e.jsx("span",{className:"text-slate-400",children:"Sin fecha"})}),e.jsx(V,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-900",children:(v==null?void 0:v.nombre_completo)||"N/A"}),(v==null?void 0:v.email)&&e.jsx("p",{className:"text-xs text-slate-500",children:v.email})]})}),e.jsx(V,{children:v!=null&&v.empresa?e.jsx(K,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:v.empresa}):e.jsx("span",{className:"text-slate-400 text-sm",children:"-"})}),e.jsx(V,{children:e.jsx("p",{className:"font-medium text-slate-900",children:j.titulo})}),e.jsx(V,{children:j.descripcion?e.jsx("p",{className:"text-sm text-slate-600 line-clamp-2 max-w-md",children:j.descripcion}):e.jsx("span",{className:"text-slate-400 text-sm",children:"Sin descripción"})}),e.jsx(V,{className:"text-right",children:e.jsxs("p",{className:"text-lg font-bold text-emerald-700",children:["$",j.monto.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})]})})]},j.id)})})]})})})]})]})]})]})}function is(){const[i,a]=x.useState(null),[t,r]=x.useState(7),[s,n]=x.useState(!0),[o,l]=x.useState(!1),[d,m]=x.useState(!1);x.useEffect(()=>{c()},[]);const c=async()=>{n(!0);try{const h=await te.me();a(h),r(h.dias_alerta_global||7)}catch(h){console.error("Error cargando usuario:",h)}n(!1)},f=async()=>{l(!0);try{await te.updateMyUserData({dias_alerta_global:t}),m(!0),setTimeout(()=>m(!1),3e3),await c()}catch(h){console.error("Error guardando configuración:",h)}l(!1)};return s?e.jsx("div",{className:"p-4 md:p-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsx(I,{className:"h-12 w-64"}),e.jsx(I,{className:"h-96"})]})}):e.jsx("div",{className:"p-4 md:p-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-slate-900 mb-2",children:"Configuración"}),e.jsx("p",{className:"text-slate-500",children:"Personaliza el comportamiento del sistema"})]}),e.jsxs(E,{className:"border-0 shadow-lg shadow-slate-200/50",children:[e.jsx(M,{className:"border-b border-slate-100",children:e.jsxs(A,{className:"flex items-center gap-3 text-xl font-bold text-slate-900",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg",children:e.jsx(Oe,{className:"w-5 h-5 text-white"})}),"Alertas de Inactividad"]})}),e.jsxs(P,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 flex gap-3",children:[e.jsx(ue,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-900 font-medium mb-1",children:"¿Qué son las alertas de inactividad?"}),e.jsx("p",{className:"text-sm text-blue-700",children:"El sistema te avisará cuando una tarea no haya sido actualizada en el número de días que configures aquí. Las tareas inactivas aparecerán destacadas en el Dashboard y en el listado de tareas."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"dias_alerta",className:"text-base font-semibold text-slate-900",children:"Días máximos sin actividad"}),e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"Ingresa el número de días que puede pasar una tarea sin cambios antes de mostrar una alerta"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(C,{id:"dias_alerta",type:"number",min:"1",max:"365",value:t,onChange:h=>r(parseInt(h.target.value)||1),className:"max-w-xs h-12 text-lg font-semibold border-slate-200 focus:border-blue-400 focus:ring-blue-400"}),e.jsx("span",{className:"text-slate-600 font-medium",children:"días"})]})]}),e.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-slate-900 mb-2",children:"Ejemplo:"}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Si configuras ",e.jsxs("strong",{children:[t," días"]}),", todas las tareas que no hayan sido actualizadas en los últimos ",t,' días mostrarán una alerta visual y aparecerán en la sección "Alertas de Inactividad" del Dashboard.']})]})]}),e.jsxs("div",{className:"pt-6 border-t border-slate-100 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-slate-500",children:["Usuario actual: ",e.jsx("span",{className:"font-medium text-slate-900",children:i==null?void 0:i.full_name})]}),e.jsx("p",{className:"text-xs text-slate-400",children:i==null?void 0:i.email})]}),e.jsx(N,{onClick:f,disabled:o,className:"bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white shadow-lg shadow-blue-500/30",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ga,{className:"w-4 h-4 mr-2"}),"Guardar Configuración"]})})]}),d&&e.jsxs("div",{className:"bg-emerald-50 border border-emerald-200 rounded-xl p-4 flex items-center gap-3 animate-in fade-in duration-300",children:[e.jsx("div",{className:"w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("p",{className:"text-emerald-800 font-medium",children:"¡Configuración guardada exitosamente!"})]})]})]}),e.jsx("div",{className:"mt-6 bg-amber-50 border border-amber-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ue,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-amber-900 mb-1",children:"Nota importante"}),e.jsx("p",{className:"text-sm text-amber-700",children:"Esta configuración afecta a todas las tareas activas del sistema. Las alertas se mostrarán automáticamente cuando una tarea supere el período de inactividad configurado."}),e.jsx("p",{className:"text-sm text-amber-700 mt-2 font-medium",children:'⚠️ Las tareas con estado "Cobrada" NO generan alertas de inactividad, ya que se consideran finalizadas y no requieren seguimiento adicional.'})]})]})})]})})}function rs(){const i=Na(),[a,t]=x.useState(null),[r,s]=x.useState([]),[n,o]=x.useState(!0),[l,d]=x.useState(!1),[m,c]=x.useState(null),h=new URLSearchParams(window.location.search).get("id");x.useEffect(()=>{h&&(async()=>{o(!0);const[S,R]=await Promise.all([O.list().then(g=>g.find(T=>T.id===h)),k.filter({cliente_id:h},"-updated_date")]);t(S),s(R),o(!1)})()},[h]);const z=async()=>{o(!0);const[b,S]=await Promise.all([O.list().then(R=>R.find(g=>g.id===h)),k.filter({cliente_id:h},"-updated_date")]);t(b),s(S),o(!1)},_=async b=>{m?await k.update(m.id,b):await k.create({...b,cliente_id:h}),d(!1),c(null),z()},D=async(b,S,R=null)=>{const g={...b,estado:S,ultima_actualizacion:new Date().toISOString()};S==="finalizada"&&!b.fecha_finalizacion&&(g.fecha_finalizacion=new Date().toISOString().split("T")[0]),S==="cobrada"&&(g.fecha_cobro=R||new Date().toISOString().split("T")[0]),await k.update(b.id,g),z()};if(n||!a)return e.jsx("div",{className:"p-8 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-slate-500",children:"Cargando información del cliente..."})]})});const j=r.filter(b=>b.estado==="cobrada").reduce((b,S)=>b+(S.monto||0),0),p=r.filter(b=>b.estado==="finalizada").reduce((b,S)=>b+(S.monto||0),0),v=r.filter(b=>b.estado!=="cobrada").length;return e.jsx("div",{className:"p-4 md:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs(N,{variant:"outline",onClick:()=>i(J("Clientes")),className:"mb-6",children:[e.jsx(ba,{className:"w-4 h-4 mr-2"}),"Volver a Clientes"]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs(E,{className:"lg:col-span-1 border-0 shadow-lg shadow-slate-200/50",children:[e.jsx(M,{className:"border-b border-slate-100",children:e.jsx(A,{className:"text-2xl font-bold text-slate-900",children:a.nombre_completo})}),e.jsxs(P,{className:"p-6 space-y-4",children:[a.empresa&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ie,{className:"w-5 h-5 text-slate-400"}),e.jsx("span",{className:"text-slate-700",children:a.empresa})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ae,{className:"w-5 h-5 text-slate-400"}),e.jsx("span",{className:"text-slate-700",children:a.email})]}),a.telefono&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Re,{className:"w-5 h-5 text-slate-400"}),e.jsx("span",{className:"text-slate-700",children:a.telefono})]}),(a.ciudad||a.pais)&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(qe,{className:"w-5 h-5 text-slate-400"}),e.jsxs("span",{className:"text-slate-700",children:[a.ciudad,a.pais?`, ${a.pais}`:""]})]}),a.direccion&&e.jsxs("div",{className:"pt-4 border-t border-slate-100",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-1",children:"Dirección"}),e.jsx("p",{className:"text-slate-700",children:a.direccion})]}),a.notas&&e.jsxs("div",{className:"pt-4 border-t border-slate-100",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-1",children:"Notas"}),e.jsx("p",{className:"text-slate-700 text-sm",children:a.notas})]}),e.jsx("div",{className:"pt-4 border-t border-slate-100",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-slate-400"}),e.jsxs("span",{className:"text-sm text-slate-500",children:["Alerta configurada: ",a.dias_alerta," días"]})]})})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsx(E,{className:"border-0 shadow-lg shadow-slate-200/50",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(de,{className:"w-5 h-5 text-blue-600"})}),e.jsx("span",{className:"text-sm text-slate-500",children:"Tareas Activas"})]}),e.jsx("p",{className:"text-3xl font-bold text-slate-900",children:v})]})}),e.jsx(E,{className:"border-0 shadow-lg shadow-slate-200/50",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-emerald-100 rounded-lg",children:e.jsx(L,{className:"w-5 h-5 text-emerald-600"})}),e.jsx("span",{className:"text-sm text-slate-500",children:"Total Cobrado"})]}),e.jsxs("p",{className:"text-3xl font-bold text-emerald-600",children:["$",j.toLocaleString("es-ES",{minimumFractionDigits:0})]})]})}),e.jsx(E,{className:"border-0 shadow-lg shadow-slate-200/50",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:e.jsx(L,{className:"w-5 h-5 text-amber-600"})}),e.jsx("span",{className:"text-sm text-slate-500",children:"Por Cobrar"})]}),e.jsxs("p",{className:"text-3xl font-bold text-amber-600",children:["$",p.toLocaleString("es-ES",{minimumFractionDigits:0})]})]})})]}),e.jsxs(E,{className:"border-0 shadow-lg shadow-slate-200/50",children:[e.jsxs(M,{className:"border-b border-slate-100 flex flex-row items-center justify-between",children:[e.jsx(A,{className:"text-xl font-bold text-slate-900",children:"Tareas del Cliente"}),e.jsx(N,{onClick:()=>{c(null),d(!0)},className:"bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white",children:"Nueva Tarea"})]}),e.jsx(P,{className:"p-6",children:r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(de,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500",children:"No hay tareas para este cliente"}),e.jsx(N,{onClick:()=>d(!0),variant:"outline",className:"mt-4",children:"Crear Primera Tarea"})]}):e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:e.jsx(U,{children:r.map(b=>e.jsx(He,{tarea:b,cliente:a,onEdit:S=>{c(S),d(!0)},onEstadoChange:D},b.id))})})})]})]})]}),e.jsx(U,{children:l&&e.jsx(Je,{tarea:m,onSubmit:_,onCancel:()=>{d(!1),c(null)}})})]})})}function ns(){return e.jsx(wa,{children:e.jsx(Ra,{children:e.jsxs(ya,{children:[e.jsx($,{path:"/",element:e.jsx(we,{})}),e.jsx($,{path:"/dashboard",element:e.jsx(we,{})}),e.jsx($,{path:"/clientes",element:e.jsx(Pt,{})}),e.jsx($,{path:"/clientes/:id",element:e.jsx(rs,{})}),e.jsx($,{path:"/tareas",element:e.jsx(Qt,{})}),e.jsx($,{path:"/cobros",element:e.jsx(ss,{})}),e.jsx($,{path:"/configuracion",element:e.jsx(is,{})}),e.jsx($,{path:"*",element:e.jsx(we,{})})]})})})}_a.createRoot(document.getElementById("root")).render(e.jsx(u.StrictMode,{children:e.jsx(ns,{})}));
